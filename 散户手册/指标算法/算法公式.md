VAR1:=REF((LOW+OPEN+CLOSE+HIGH)/4,1);
VAR2:=SMA(ABS(LOW-VAR1),13,1)/SMA(MAX(LOW-VAR1,0),10,1);
VAR3:=EMA(VAR2,10);
VAR4:=LLV(LOW,33);
VAR5:=EMA(IF(LOW<=VAR4,VAR3,0),3);
警戒线:22.5,DOTLINE,COLORWHITE;
分水岭:47.5,COLORMAGENTA;
主力进场:VAR5>REF(VAR5,1);
洗盘:VAR5<REF(VAR5,1);
XG:REF(主力进场,1) AND REF(主力进场,2) AND 洗盘;
STICKLINE(主力进场,0,VAR5,6,0 ),COLORRED;
STICKLINE(洗盘,0,VAR5,6,0),COLORGREEN;
DRAWICON(XG,51,9);

{
选股公式:
VAR1:=REF((LOW+OPEN+CLOSE+HIGH)/4,1);
VAR2:=SMA(ABS(LOW-VAR1),13,1)/SMA(MAX(LOW-VAR1,0),10,1);
VAR3:=EMA(VAR2,10);
VAR4:=LLV(LOW,33);
VAR5:=EMA(IF(LOW<=VAR4,VAR3,0),3);
主力进场:=VAR5>REF(VAR5,1);
洗盘:=VAR5<REF(VAR5,1);
REF(主力进场,1) AND REF(主力进场,2) AND 洗盘;
}


- 备注：
REF(a, b) => 代表过去的数值，a代表数值，b代表天数，
SMA(a, b, c) => 
EMA(a, b) => 指数平均数指标
LLV(a, b) => 连日来的最低价中的最低值，a代表数值，b代表天数
HHV(a, b) => 连日来的最高价中的最高值，a代表数值，b代表天数
ABS(a) => 绝对值
IF(a, b, c) => 三元运算

## SMA（）
1. 计算不同：

MA是将某一段时间的收盘价之和除以该周期，比如日线MA5指5天内的收盘价除以5 。

SMA是指算术平均数，计算方法为一组数字相加，除以该组数据的组成个数，其中每一给定时限在计算平均值时的权重均相等 。

2. 指不同的平均线：

MA是指移动平均线，由于我们将其制作成线形，所以一般称之为移动平均线，简称均线。

SMA是指简单移动平均线，算术移动平均线是简单而普遍的移动平均线。




## EMA（Exponential Moving Average）
EMA（Exponential Moving Average），指数平均数指标，也叫EXPMA指标，它也是一种趋向类指标，是以指数式递减加权的移动平均。

w代表平滑系数。

此公式是电脑计算股票当日指数平滑移动均值的函数。

1. 求X的N日指数平滑移动平均，在股票公式中一般表达为：EMA（X，N），它真正的公式表达是：当日指数平均值=平滑系数*（当日指数值-昨日指数平均值）+昨日指数平均值；平滑系数=2/（周期单位+1）。

2. 由以上公式推导开，得到：EMA(C,N)=2*C/(N+1)+(N-1)/(N+1)*昨天的指数收盘平均值； 算法是：若Y=EMA(X，N)，则Y=〔2*X+(N-1)*Y’〕/(N+1)，其中Y’表示上一周期的Y值。

3. EMA引用函数在计算机上使用递归算法很容易实现，但不容易理解。例举分析说明EMA函数：

 X是变量，每天的X值都不同，从远到近地标记，它们分别记为X1，X2，X3，….，Xn。

如果N=1，则EMA(X，1)=〔2*X1+(1-1)*Y’〕/(1+1)=X1 

如果N=2，则EMA(X，2)=〔2*X2+(2-1)*Y’〕/(2+1)=(2/3)*X2+(1/3)X1 

如果N=3，则EMA(X，3)=〔2*X3+(3-1)*Y’〕/(3+1)=〔2*X3+2*((2/3)*X2+(1/3)*X1)〕/4=(1/2)*X3+(1/3)*X2+(1/6)*X1 

如果N=4，则EMA(X，4)=〔2*X4+(4-1)*Y’〕/(4+1)=2/5*X4+3/5*((1/2)*X3+(1/3)*X2+(1/6)*X1) =2/5*X4+3/10*X3+1/5*X2+1/10*X1 

如果N=5，则EMA(X，5)=2/(5+1)*X5+(5-1)/(5+1)(2/5*X4+3/10*X3+3/15*X2+3/30*X1) =(1/3)*X5+(4/15)*X4+(3/15)*X3+(2/15)*X2+(1/15)*X1 

…………循环 X1 (2/3)*X2+(1/3)X1 (3/6)*X3+(2/6)*X2+(1/6)*X1 (4/10)*X4+(3/10)*X3+(2/10)*X2+(1/10)*X1 (5/15)*X5+(4/15)*X4+(3/15)*X3+(2/15)*X2+(1/15)*X1 

注：任何时候系数之和恒为1。如果X是常量，每天的X值都不变，则EMA(X,N)=MA(X,N)。 

4. 从以上的例举分析中，我们可以看到时间周期越近的X值它的权重越大，说明EMA函数对近期的X值加强了权重比，更能及时反映近期X值的波动情况。