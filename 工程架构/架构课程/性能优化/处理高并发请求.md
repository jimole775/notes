# 操作系统多任务运行环境
计算机的CPU核心数是有限的，但是，服务器可以同时处理数以百计甚至上千的并发用户请求。

那么，计算机是如何做到的？

- 多进程分时执行

## 进程的运行期状态
- 运行：当一个进程在CPU上运行时，则称该进程语出运行状态。处于运行状态的进程数据小于等于CPU的数目
- 就绪：当一个进程获得了除 CPU 以外的一切所需资源，只要得到CPU即可运行，则称此进程处于就绪状态，就绪状态有时候也被称为等待运行状态
- 阻塞：也称为等待或睡眠状态，当一个进程在等待某一事件发生（例如等待 I/O 完成，等待锁...）而暂时停止运行，这时即使把CPU分配给进程也无法运行，故该进程处于阻塞状态

## 进程 VS 线程
不同进程轮流在 CPU 上执行，每次都要进行进程间的 CPU 切换，代价非常大。因此服务器应用通常是单进程多线程。

进程从操作系统获得基本的内存空间，所有的线程共享着进程的内存地址空间。而每个线程也会拥有自己的私有内存地址范围，其他线程不能访问。

# 线程安全问题

1. 临界区
多个线程访问共享资源的这段代码被称为临界区，解决线程安全问题的主要方法是使用锁，将临界区的代码加锁，只有获得锁的线程才能执行临界区代码

``` java
lock.lock(); // 线程获得锁
i++; // 临界区代码，i位于堆中
lock.unlock(); // 线程释放锁
```

2. 阻塞导致高并发系统崩溃

锁（I/O）会引起线程阻塞。阻塞导致线程既不能继续执行，也不能释放资源。进而导致资源耗尽，最终导致崩溃。