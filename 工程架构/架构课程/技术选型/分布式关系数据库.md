# 一主多从说明
**主服务器** 主要负责 **写** 操作，**从服务器** 负责 **读** 操作。

可以使用多套 主从 配置，来防止宕机造成瘫痪威胁。

# 一主多从的优点
- 分摊负载：分摊 QPS 的压力
- 专机专用：类似于表的规划
- 便于冷备：让一台服务器专门做备份，不影响其他业务
- 高可用：主服务器宕机，进行主主复制之后，其他服务器可以当作主服务器使用

# 主主失效的维护过程
主服务器 A 失效 => 检测到失效 => 将 **写** 操作发送到第二主服务器 B，将 **读** 操作发送到从服务器 => 开始重建失效的 主服务器 A 及其从服务器 => 完全恢复，所有主服务器都重新正确运行，主服务器 A 和 主服务器 B 之间保持复制和同步

# mysql 的注意事项
- **主主复制的两个数据库不能并发写入**
- **复制只是增加了数据的读并发处理能力，没有增加写并发能力和存储能力**
- **更新表结构会导致巨大的同步延迟**

# 数据分片（提高写并发能力）
- 分片目标
- 分片特点
- 分片原理

### 分片方法
1. 硬编码方式：根据用户id来进行分片（奇偶法、映射法）
- 硬编码分片的挑战：
    - 需要大量的额外代码，处理逻辑因此变得更加复杂
    - 无法执行多分片的联合查询
    - 无法使用数据库的事务
    - 随着数据的增长，如何增加更多的服务器
2. Mycat 中间件、Cobar 中间件

# 集群伸缩
和分布式缓存的 **路由算法** 的问题相似

- 使用 `key%N` 这种取模算法时，可以做一下应对：

如果又 2 台数据库，那么可以设置 100 个数据库实例，每 50 个实例绑定一个 数据库 IP 就可以了

以后扩展的时候，修改 实例们 绑定的 IP 就可以了
