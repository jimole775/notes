# DMA(直接存储访问)

## 1. 原理
DMA 传输将数据从一个地址空间复制到另外一个地址空间。

当 CPU 初始化这个传输动作，传输动作本身是由 DMA 控制器来实行和完成。

典型的例子就是移动一个外部内存的区块到芯片内部更快的内存区。

像是这样的操作并没有让处理器工作拖延，反而可以被重新排程去处理其他的工作。

DMA 传输对于高效能嵌入式系统算法和网络是很重要的。

在实现 DMA 传输时，是由 DMA 控制器直接掌管总线，因此，存在着一个总线控制权转移问题。

即 DMA 传输前，CPU 要把总线控制权交给 DMA 控制器，而在结束 DMA 传输后，DMA 控制器应立即把总线控制权再交回给CPU。

一个完整的 DMA 传输过程必须经过 DMA 请求、DMA响应、DMA传输、DMA结束 4个步骤。

## 2. 请求

CPI 对 DMA 控制器初始化，并向 I/O 接口发出操作命令，I/O 接口提出 DMA 请求。

## 3. 响应

DMA 控制器对 DMA 请求盘别优先级及屏蔽，向总线裁决逻辑提出总线请求。

当 CPU 执行完当前总线周期即可释放总线控制权。

此时，总线裁决逻辑输出总线应答，表示 DMA 已经响应，通过 DMA 控制器通知 I/O 接口开始 DMA 传输。

## 4. 传输
DMA 控制器获得总线控制权后，CPU 即刻挂起或只执行内部操作，由 DMA 控制器输出读写命令，直接控制 RAM 与 I/O 接口进行 DMA 传输。

在 DMA 控制器的控制下，在存储器和外部设备之间直接进行数据传送，在传送过程中不需要中央处理器的参与。

开始时需提供要传送的数据的起始位置和数据长度。

## 5. 结束
当完成规定的成批数据传送后，DMA 控制器即释放总线控制权，并向 I/O 接口发出结束信号。

当 I/O 接口收到结束信号后，一方面停止 I/O 设备的工作，另一方面向 CPU 提出钟断请求，使 CPU 从不介入的状态解脱，并执行一段检查本次 DMA 传输操作正确性的代码。

最后，带着本次操作结果及状态继续执行原来的程序。

由此可见，DMA 传输方式无需 CPU 直接控制传输，也没有钟断处理方式那样保留现场和恢复现场的过程，通过硬件为 RAM 与 I/O 设备开辟一条直接传送数据的通路，使 CPU 的效率大为提高。